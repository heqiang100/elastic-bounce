/*!
 * elastic-bounce v1.0.0
 * (c) 2025 xhq
 * 一个轻量级的移动端弹性滚动效果库
 * Released under the MIT License.
 * @see https://github.com/heqiang100/elastic-bounce
 * Date: 2025-02-25
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ElasticBounce={})}(this,(function(t){"use strict";class e{static checkSupport(){return!!("ontouchstart"in window&&document.documentElement.classList&&"transform"in document.documentElement.style&&"function"==typeof window.getComputedStyle&&window.requestAnimationFrame)}constructor(t,i={}){this.startY=0,this.lastY=0,this.isTouching=!1,this.scrollElement=null,this.touchMoveTimer=null,this.boundTouchStart=()=>{},this.boundTouchMove=()=>{},this.boundTouchEnd=()=>{},this.isSupported=!1,this.animationFrameId=null,this.element=t,this.options=Object.assign(Object.assign({},e.defaultOptions),i),this.isSupported=e.checkSupport(),this.isSupported&&(this.boundTouchStart=this.handleTouchStart.bind(this),this.boundTouchMove=function(t,e=16){let i=0;return function(...s){const n=Date.now();n-i>=e&&(t.apply(this,s),i=n)}}(this.handleTouchMove.bind(this),16),this.boundTouchEnd=function(t,e=16){let i=null;return function(...s){i&&clearTimeout(i),i=window.setTimeout((()=>{t.apply(this,s),i=null}),e)}}(this.handleTouchEnd.bind(this),16),this.init())}init(){if(this.isSupported)try{this.scrollElement=this.element;const t=window.getComputedStyle(this.element);("auto"===t.overflowY||"scroll"===t.overflowY)&&this.element.scrollHeight>this.element.clientHeight||(this.element.style.overflowY="auto",this.element.style["-webkit-overflow-scrolling"]="touch"),this.scrollElement.classList.add("elastic-bounce-content"),this.bindEvents()}catch(t){this.isSupported=!1}}findScrollableElement(t){try{const e=window.getComputedStyle(t);if(("auto"===e.overflowY||"scroll"===e.overflowY)&&t.scrollHeight>t.clientHeight)return t;for(let e=0;e<t.children.length;e++){const i=t.children[e],s=window.getComputedStyle(i);if(("auto"===s.overflowY||"scroll"===s.overflowY)&&i.scrollHeight>i.clientHeight)return i;const n=this.findScrollableElement(i);if(n)return n}}catch(t){}return null}bindEvents(){if(this.isSupported&&this.scrollElement)try{this.scrollElement.addEventListener("touchstart",this.boundTouchStart,{passive:!0}),this.scrollElement.addEventListener("touchmove",this.boundTouchMove,{passive:!1}),this.scrollElement.addEventListener("touchend",this.boundTouchEnd),this.scrollElement.addEventListener("touchcancel",this.boundTouchEnd)}catch(t){this.isSupported=!1}}isExcluded(t){try{return this.options.excludeSelectors.some((e=>t.matches(e)||null!==t.closest(e)))}catch(t){return!1}}handleTouchStart(t){if(this.isSupported&&this.scrollElement&&!this.isExcluded(t.target))try{this.startY=this.lastY=t.touches[0].clientY,this.isTouching=!0,this.scrollElement.style.transition="none",this.scrollElement.style.transform="none"}catch(t){}}handleTouchMove(t){if(this.isSupported&&this.scrollElement&&this.isTouching&&!this.isExcluded(t.target))try{const e=t.touches[0].clientY,i=e-this.lastY,s=e-this.startY,n=this.scrollElement.scrollTop,o=this.scrollElement.scrollHeight-this.scrollElement.clientHeight,l=n<=0,r=Math.abs(n-o)<1,c=this.scrollElement.contains(t.target),a=this.findScrollableParent(t.target);if(c&&a&&a!==this.scrollElement){const t=a.scrollTop,e=a.scrollHeight-a.clientHeight,s=t<=0,n=Math.abs(t-e)<1;if(!(s&&i>0||n&&i<0))return}(l&&i>0||r&&i<0)&&(t.cancelable&&t.preventDefault(),this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.animationFrameId=requestAnimationFrame((()=>{if(!this.scrollElement)return;const t=s*this.options.resistance,e=s>0?1:-1,i=Math.pow(Math.abs(t),.8)*e,n=1+Math.min(Math.abs(i)/this.scrollElement.clientHeight,this.options.maxStretch);this.scrollElement.style.transform=`scaleY(${n})`,this.scrollElement.style.transformOrigin=s>0?"top":"bottom"}))),this.lastY=e}catch(t){}}findScrollableParent(t){for(;t&&t!==document.body;){const e=window.getComputedStyle(t);if(("auto"===e.overflowY||"scroll"===e.overflowY)&&t.scrollHeight>t.clientHeight)return t;t=t.parentElement}return null}handleTouchEnd(){if(this.isSupported&&this.scrollElement&&this.isTouching)try{this.isTouching=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),requestAnimationFrame((()=>{if(!this.scrollElement)return;const t=this.options.animationDuration,e=this.options.animationFunction;this.scrollElement.style.transition=`transform ${t}ms ${e}`,this.scrollElement.style.transform="none",setTimeout((()=>{!this.isTouching&&this.scrollElement&&(this.scrollElement.style.transition="none")}),t)}))}catch(t){}}updateOptions(t){this.isSupported&&(this.options=Object.assign(Object.assign({},this.options),t))}destroy(){if(this.isSupported&&this.scrollElement)try{this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.touchMoveTimer&&(clearTimeout(this.touchMoveTimer),this.touchMoveTimer=null),this.scrollElement.removeEventListener("touchstart",this.boundTouchStart),this.scrollElement.removeEventListener("touchmove",this.boundTouchMove),this.scrollElement.removeEventListener("touchend",this.boundTouchEnd),this.scrollElement.removeEventListener("touchcancel",this.boundTouchEnd),this.scrollElement.classList.remove("elastic-bounce-content"),this.scrollElement.style.transform="",this.scrollElement.style.transformOrigin="",this.scrollElement.style.transition="",this.scrollElement===this.element&&(this.element.style.overflowY="",this.element.style["-webkit-overflow-scrolling"]="")}catch(t){}}}e.defaultOptions={maxStretch:.15,resistance:.3,animationDuration:300,animationFunction:"ease-out",touchThreshold:5,excludeSelectors:[]};class i{static checkSupport(){return!!(window.MutationObserver&&window.Map&&"function"==typeof document.querySelector&&document.documentElement.classList)}static init(t={}){if(this.isSupported=this.checkSupport(),this.isSupported)try{this.options=Object.assign({},this.defaults,t),this._setupGlobalStyles(),this._startObserving()}catch(t){this.isSupported=!1}}static _setupGlobalStyles(){if(this.isSupported)try{if(!document.getElementById("elastic-bounce-styles")){const t=document.createElement("style");t.id="elastic-bounce-styles",t.textContent=`\n                    .elastic-bounce-content {\n                        transform-origin: top;\n                        transition: transform ${this.options.animationDuration}ms ${this.options.animationFunction};\n                        will-change: transform;\n                        height: 100%;\n                        -webkit-overflow-scrolling: touch;\n                    }\n                `,document.head.appendChild(t)}}catch(t){}}static _startObserving(){var t;if(this.isSupported)try{this.observer&&this.observer.disconnect(),window.MutationObserver&&(this.observer=new MutationObserver((t=>{t.forEach((t=>{t.addedNodes.forEach((t=>{var e;if(1===t.nodeType){const i=t;i.matches&&i.matches(this.options.container)&&this._initContainer(i);const s=null===(e=i.querySelectorAll)||void 0===e?void 0:e.call(i,this.options.container);null==s||s.forEach((t=>{this._initContainer(t)}))}})),t.removedNodes.forEach((t=>{if(1===t.nodeType){const e=t;if(this.instances.has(e)&&this._destroyContainer(e),e.querySelectorAll){e.querySelectorAll(this.options.container).forEach((t=>{this.instances.has(t)&&this._destroyContainer(t)}))}}}))}))})),this.observer.observe(document.body,{childList:!0,subtree:!0}),null===(t=document.querySelectorAll(this.options.container))||void 0===t||t.forEach((t=>{this._initContainer(t)})))}catch(t){this.isSupported=!1}}static _initContainer(t){if(this.isSupported)try{if("false"===t.getAttribute("data-elastic"))return;if(this.instances.has(t))return;const i=new e(t,this.options);this.instances.set(t,i)}catch(t){}}static _destroyContainer(t){if(this.isSupported)try{const e=this.instances.get(t);if(!e)return;e.destroy(),this.instances.delete(t)}catch(t){}}static update(){var t,e;if(this.isSupported)try{null===(e=null===(t=document.querySelectorAll)||void 0===t?void 0:t.call(document,this.options.container))||void 0===e||e.forEach((t=>{this.instances.has(t)||this._initContainer(t)}))}catch(t){}}static updateOptions(t){if(this.isSupported)try{this.options=Object.assign({},this.options,t),this._setupGlobalStyles(),this.update()}catch(t){}}static destroy(){if(this.isSupported)try{this.observer&&(this.observer.disconnect(),this.observer=null),this.instances.forEach(((t,e)=>{this._destroyContainer(e)})),this.instances.clear();const t=document.getElementById("elastic-bounce-styles");t&&t.remove()}catch(t){}}static enableElastic(t){if(this.isSupported)try{t.removeAttribute("data-elastic"),this._initContainer(t)}catch(t){}}static disableElastic(t){if(this.isSupported)try{t.setAttribute("data-elastic","false"),this.instances.has(t)&&this._destroyContainer(t)}catch(t){}}}i.instances=new Map,i.observer=null,i.isSupported=!1,i.defaults={container:".elastic-container",excludeSelectors:[],maxStretch:.15,resistance:.3,animationDuration:300,animationFunction:"ease-out",touchThreshold:5};const s=i.init.bind(i),n=i.update.bind(i),o=i.updateOptions.bind(i),l=i.destroy.bind(i),r=i.enableElastic.bind(i),c=i.disableElastic.bind(i);var a={init:s,update:n,updateOptions:o,destroy:l,enableElastic:r,disableElastic:c};t.default=a,t.destroy=l,t.disableElastic=c,t.enableElastic=r,t.init=s,t.update=n,t.updateOptions=o,Object.defineProperty(t,"__esModule",{value:!0})}));
